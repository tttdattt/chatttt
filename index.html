<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚·ãƒ³ãƒ—ãƒ«ãƒãƒ£ãƒƒãƒˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { 
            --bg: #0f172a; --panel: #1e293b; --chat: #0f172a; --text: #f8fafc; 
            --accent: #38bdf8; --my-msg: #38bdf8; --other-msg: #334155; --border: #334155; 
        }
        .light-theme {
            --bg: #f1f5f9; --panel: #ffffff; --chat: #f8fafc; --text: #0f172a; 
            --accent: #0284c7; --my-msg: #0284c7; --other-msg: #e2e8f0; --border: #cbd5e1;
        }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; transition: 0.3s; }
        .app-wrapper { display: grid; grid-template-columns: 320px 1fr 350px; height: 100vh; gap: 1px; background: var(--border); }
        section { background: var(--panel); display: flex; flex-direction: column; overflow: hidden; }
        .header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 1.2rem; }
        .scroll { flex: 1; overflow-y: auto; padding: 20px; }
        .room-card { background: var(--bg); padding: 12px; border-radius: 12px; margin-bottom: 10px; cursor: pointer; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .room-card:hover { border-color: var(--accent); }
        .room-limit { font-size: 0.8rem; text-align: right; color: var(--accent); margin-bottom: 10px; }
        .msg-list { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 75%; padding: 12px 18px; border-radius: 20px; font-size: 1rem; line-height: 1.5; }
        .msg.mine { align-self: flex-end; background: var(--my-msg); color: #000; border-bottom-right-radius: 4px; }
        .msg.other { align-self: flex-start; background: var(--other-msg); color: var(--text); border-bottom-left-radius: 4px; }
        .input-area { padding: 20px; background: var(--chat); }
        .bar { display: flex; align-items: center; background: var(--panel); border-radius: 30px; padding: 5px 20px; border: 1px solid var(--border); }
        .bar input { flex: 1; border: none; background: transparent; padding: 12px; color: var(--text); outline: none; }
        .switch { width: 50px; height: 26px; position: relative; cursor: pointer; }
        .switch input { opacity: 0; }
        .slider { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #475569; border-radius: 30px; transition: 0.4s; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: 0.4s; }
        input:checked + .slider { background: var(--accent); }
        input:checked + .slider:before { transform: translateX(24px); }
        .btn { background: var(--accent); color: #000; border: none; border-radius: 20px; padding: 10px 20px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .hidden { display: none !important; }
        input[type="text"], input[type="password"] { width: 100%; background: var(--bg); border: 1px solid var(--border); color: white; padding: 10px; border-radius: 10px; margin-top: 5px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <section>
        <div class="header">Rooms</div>
        <div class="scroll">
            <div class="room-limit">Room Limit: <span id="room-count">0</span>/10</div>
            <div id="create-area" style="margin-bottom: 20px; background: var(--bg); padding: 15px; border-radius: 15px;">
                <input type="text" id="new-room-name" placeholder="éƒ¨å±‹å">
                <input type="password" id="new-room-pass" placeholder="å…¥å®¤ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (ä»»æ„)">
                <button class="btn" onclick="createRoom()">Create New Room</button>
            </div>
            <div id="room-list"></div>
        </div>
    </section>

    <section style="background: var(--chat);">
        <div class="header">
            <span id="current-room">Main Lobby</span>
            <div style="display: flex; align-items: center; gap: 15px;">
                <label class="switch"><input type="checkbox" id="mode-toggle" onchange="toggleTheme()"><span class="slider"></span></label>
                <span style="cursor:pointer;" onclick="alert('è¨­å®šã¯å³ãƒ‘ãƒãƒ«ã®ä¸‹ã®æ–¹ã«ã‚ã‚‹ã‚ˆ')">âš™ï¸</span>
            </div>
        </div>
        <div id="message-list" class="msg-list"></div>
        <div class="input-area">
            <div class="bar">
                <label style="cursor:pointer;">ğŸ“·<input type="file" hidden id="img-upload"></label>
                <input type="text" id="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...">
                <button class="btn" style="width: 80px; margin: 0;" onclick="sendMsg()">é€ä¿¡</button>
            </div>
        </div>
    </section>

    <section>
        <div class="header">Settings & Admin</div>
        <div class="scroll">
            <div id="auth-section" style="background: var(--bg); padding: 15px; border-radius: 15px; margin-bottom: 20px;">
                <h4>Settings</h4>
                <p style="font-size:0.7rem; opacity:0.6; margin-bottom:10px;">è‰²ãƒ¢ãƒ¼ãƒ‰ã‚„æ¨©é™ã®è¨­å®š</p>
                <input type="password" id="admin-code" placeholder="ç®¡ç†è€…ç”¨æš—å·ã‚’å…¥åŠ›">
                <button class="btn" style="background:#ef4444; color:white;" onclick="checkAdmin()">Authenticate</button>
            </div>

            <div id="admin-panel" class="hidden">
                <div style="border: 2px solid #ef4444; padding: 15px; border-radius: 15px; margin-bottom: 20px;">
                    <h4 style="color:#ef4444;">Shared Admin Panel</h4>
                    <p style="font-size:0.8rem;">å…¨ã¦ã®å•ã„åˆã‚ã›ã‚’å…±æœ‰ä¸­</p>
                    <div id="inquiry-list" style="font-size:0.8rem; margin-bottom:10px;"></div>
                    <button class="btn" style="background:#ef4444; color:white;">User BAN List</button>
                </div>
            </div>

            <div class="card" style="background: var(--bg); padding: 15px; border-radius: 15px;">
                <h4>Support</h4>
                <textarea id="inquiry-text" style="width:100%; height:80px; background:var(--panel); border:1px solid var(--border); color:white; border-radius:10px; padding:10px;" placeholder="ç®¡ç†è€…ã«å•ã„åˆã‚ã›"></textarea>
                <button class="btn" onclick="alert('é€ä¿¡å®Œäº†ï¼ˆå…¨ç®¡ç†è€…ãŒé–²è¦§å¯èƒ½ï¼‰')">Send Inquiry</button>
            </div>
        </div>
    </section>
</div>

<script>
    // ãƒ€ãƒƒãƒˆã®Supabaseæƒ…å ±
    const SUPABASE_URL = 'https://qvwfhesfjylkgmoscwsa.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_Z-TH5yMPqJDGn2WGlzGrEQ_y8t-QAg8';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    let rooms = [];
    const ADMIN_SECRET = "dat2009"; // ç®¡ç†è€…ç”¨æš—å·

    function toggleTheme() { document.body.classList.toggle('light-theme'); }

    async function createRoom() {
        if(rooms.length >= 10) return alert("éƒ¨å±‹ã¯10å€‹ã¾ã§ï¼");
        const name = document.getElementById('new-room-name').value;
        const pass = document.getElementById('new-room-pass').value;
        if(!name) return;
        const { error } = await _supabase.from('rooms').insert([{ name: name, password: pass || null, host_id: 'Dat' }]);
        if(!error) { fetchRooms(); document.getElementById('new-room-name').value = ''; }
    }

    async function fetchRooms() {
        const { data } = await _supabase.from('rooms').select('*');
        rooms = data || [];
        document.getElementById('room-count').innerText = rooms.length;
        document.getElementById('room-list').innerHTML = rooms.map(r => `
            <div class="room-card" onclick="joinRoom('${r.id}', '${r.password}')">
                <span>${r.name} ${r.password ? 'ğŸ”’' : ''}</span>
                <span style="font-size:0.7rem; opacity:0.5;">ID: ${r.id.substring(0,5)}</span>
            </div>
        `).join('');
    }

    function joinRoom(id, pass) {
        if(pass && pass !== "null") {
            if(prompt("å…¥å®¤ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:") !== pass) return alert("ä¸ä¸€è‡´");
        }
        document.getElementById('current-room').innerText = "Room ID: " + id.substring(0,8);
        alert("å…¥å®¤æˆåŠŸã€‚ãƒ›ã‚¹ãƒˆæ¨©é™ã¯è‡ªå‹•ä»˜ä¸ã•ã‚Œã¾ã™ã€‚");
    }

    function checkAdmin() {
        if(document.getElementById('admin-code').value === ADMIN_SECRET) {
            document.getElementById('admin-panel').classList.remove('hidden');
            document.getElementById('auth-section').classList.add('hidden');
            alert("ç®¡ç†è€…èªè¨¼æˆåŠŸ");
        }
    }

    fetchRooms();
</script>
</body>
</html>